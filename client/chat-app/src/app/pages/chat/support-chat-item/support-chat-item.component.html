<!-- support-chat-item/support-chat-item.component.html -->

<li [class.active]="isSelected"
    [class.taken]="isTaken"
    (click)="select.emit(chat)">
    <a href="javascript:void(0);">
        <div class="d-flex">
            <!-- Avatar -->
            <div class="chat-user-img online align-self-center me-3 ms-0">
                @if (chat.guest_user?.image) {
                    <img [src]="chat.guest_user?.image" class="rounded-circle avatar-xs" alt="">
                } @else {
                    <div class="avatar-xs">
                        <span class="avatar-title rounded-circle bg-primary-subtle text-primary">
                            {{ chat.name.charAt(0).toUpperCase() }}
                        </span>
                    </div>
                }
                <span class="user-status"></span>
            </div>

            <!-- Info del chat -->
            <div class="flex-grow-1 overflow-hidden">
                <h4 class="text-truncate font-size-15 mb-1">{{ chat.name }}</h4>
                <p class="text-muted text-truncate font-size-13 mb-1">{{ chat.last_message || 'Sin mensajes' }}</p>
                
                <!-- Estado -->
                @if (!isTaken) {
                    <span class="badge bg-warning text-dark font-size-10">Pendiente</span>
                } @else if (isAssignedToCurrentAgent) {
                    <span class="badge bg-success font-size-10">Atendido por ti</span>
                } @else {
                    <span class="badge bg-danger font-size-10">Bloqueado - {{ agentName }}</span>
                }
            </div>

            <!-- Acciones -->
            <div class="chat-meta text-end align-self-center">
                @if (chat.unread_count > 0) {
                    <span class="badge bg-danger rounded-pill mb-1">
                        {{ chat.unread_count > 99 ? '99+' : chat.unread_count }}
                    </span>
                }
                @if (canTake) {
                    <button
                        class="btn btn-sm btn-primary"
                        (click)="onTake($event)">
                        Tomar
                    </button>
                } @else if (isAssignedToCurrentAgent) {
                    <button
                        class="btn btn-sm btn-outline-danger"
                        (click)="onRelease($event)">
                        Liberar
                    </button>
                }
            </div>
        </div>
    </a>
</li>
